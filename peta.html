<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Area Rawan Banjir</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="peta.css">
    <link rel="stylesheet" href="header-footer.css">
    <style>
        #map { height: 500px; width: 100%; }
        #weather-info { 
            background: #e0f7fa; 
            padding: 10px; 
            border-radius: 5px; 
            margin: 10px; 
            color: #00796b; 
        }
    </style>
</head>
<body>
    <div id="header-include"></div>
    <div class="container">
        <h1>Area Rawan Banjir</h1>
        <div id="map"></div>
        <div class="flood-info">
            <div class="flood-card">
                <h3>Jl. Lorem Ipsum</h3>
                <p>banjir disebabkan sungai meluap</p>
            </div>
        </div>
    </div>
    <div id="footer-include"></div>

    <script>
        fetch('header.html')
            .then(res => res.text())
            .then(data => document.getElementById('header-include').innerHTML = data);

        fetch('footer.html')
            .then(res => res.text())
            .then(data => document.getElementById('footer-include').innerHTML = data);
    </script>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([-7.9666, 112.6326], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Tambahkan kode untuk outline Kota Malang
        fetch('kota-malang.geojson')
            .then(response => response.json())
            .then(data => {
                L.geoJSON(data, {
                    style: {
                        color: '#2196F3',
                        weight: 3,
                        opacity: 0.8,
                        fillOpacity: 0.1
                    }
                }).addTo(map);
            });

        var floodLocations = [
            { lat: -7.965, lng: 112.630, title: "Jl. Lorem Ipsum", desc: "Banjir disebabkan sungai meluap" },
            { lat: -7.970, lng: 112.635, title: "Jl. Dolor Sit Amet", desc: "Banjir akibat hujan deras" }
        ];

        function updateFloodCard(title, desc) {
            const floodCard = document.querySelector('.flood-card');
            floodCard.querySelector('h3').textContent = title;
            floodCard.querySelector('p').textContent = desc;
        }

        floodLocations.forEach(function(location) {
            const marker = L.circle([location.lat, location.lng], {
                color: 'red',
                fillColor: '#f03',
                fillOpacity: 0.5,
                radius: 100
            }).addTo(map);

            marker.on('click', function() {
                reverseGeocode(location.lat, location.lng).then(roadName => {
                    updateFloodCard(roadName, location.desc);
                });
            });
        });

        function reverseGeocode(lat, lng) {
            const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lng}`;
            return fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data && data.address && data.address.road) {
                        return data.address.road;
                    } else {
                        return "Nama jalan tidak ditemukan";
                    }
                })
                .catch(() => "Gagal mendapatkan nama jalan");
        }
    </script>
</body>
</html>